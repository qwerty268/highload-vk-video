# highload-vk-video

## 1. Тема и целевая аудитория
### Тема
VK Видео — сервис, запущенный VK (ранее известной как Mail.ru Group) 15 октября 2021 года. Позиционируется как отечественный конкурент международным платформам, таким как YouTube, TikTok и Netflix.

### Целевая аудитория
   
Целевая аудитория: большая часть находится в рф. По старым отчетам можно прикинуть, что из 76 млн ежемесячнх пользователей, 70 из РФ, остальные из 6 СНГ

13–17 лет: ~15–20%

18–24 года: ~25–30%

25–34 года: ~25–30%

35–44 года: ~15–20%

45 лет и старше: ~10–15%

### MVP

**Функционал:**
1. Регистрация и авторизация.
2. Просмотр видео.
3. Поиск видео.
4. Рекомендация видео.
5. Подписки.
6. Система фитбеков:
   - Лайки.
   - Комментарии.
7. Профиль пользователя.


**Ключевые продуктовые решения:**
1. Алгоритмы, предлагающие пользователям контент на основе их предпочтений, истории просмотров и интересов.
2. Персонализированные рекомендации для увеличения вовлеченности.


## Нагрузка ##

![image](https://github.com/user-attachments/assets/45a026a6-e424-4e33-92f7-b74f87bafd5a)

DAU = 76 млн
MAU = 103 млн

## Источники
официальный отчет вк - https://corp.vkcdn.ru/media/files/RUS_Press_Release_9M_2024.pdf

## 2. Расчет нагрузки
### Продуктовые метрики
Таблица 1 - Количество активных пользователей
<table>
    <tr>
        <th>Период</th>
        <th>Количество пользователей</th>
    </tr>
    <tr>
        <td>День</td>
        <td>76 миллиона</td>
    </tr>
    <tr>
        <td>Месяц</td>
        <td>103 миллиона</td>
    </tr>
</table>

Таблица 2 - Средний размер хранилища пользователя
<table>
    <tr>
        <th>Тип хранилища</th>
        <th>Средний объем на 1 пользователя</th>
    </tr>
    <tr>
        <td>Подписки</td>
        <td>В среднем id канала занимает 12 символов. Предположем, что у пользователя 40 подписок, в таком случает размер = 12 * 40 = 480 байт </td>
    </tr>
  <tr>
        <td>История просмотров</td>
        <td>Всего в день просматривают 4.3 млрд минут, т.е. один пользователь стратит в среднем 4.3 * 10^9 / (76 * 10 ^6) = 56.5 минут. По ютубовской статистики пользователь тратит +- 1/3 на шортсы, 2/3 на длинные видео.
        Если средняя длина шортса = 30 секунд, то пользователь за день просматривает 38 коротких видео. Длинное видео длится в районе 20 минут, значит пользователь успевает посмотретьт еще 2 видео. Итого 38 + 2 = 40.
        Id видео состоит из 19 символов, 18 цифр и одно нижнее подчеркивание. Если нужно хранить историю за последний месяц, то получится следующий результат: 18 * 40 * 31 = 22 320 байт = **21.8 Кбайт**</td>
    </tr>
</table>

Таблица 3 - Действия пользователей по типам
<table border="1">
    <tr>
        <th>Тип действия</th>
        <th>Среднее количество в день</th>
    </tr>
    <tr>
        <td>Воспроизведение видео</td>
        <td>В среднем пользователь смотрит 38 шортс и 2 длинных видео в день, всего: 76 * (38 + 2) = <b>3,04 млрд</b> просмотров</td>
    </tr>
    <tr>
        <td>Авторизация/регистрация</td>
        <td><b>76 млн</b></td>
    </tr>
    <tr>
        <td>Лайк/дизлайк видео</td>
        <td>В среднем пользователь ставит 3 реакции в день, всего: 76 * 3 = <b>228 млн</b></td>
    </tr>
    <tr>
        <td>Комментарии под видео</td>
        <td>В среднем 1% пользователей комментируют видео, всего: 76 * 0,01 = <b>0,76 млн</b> комментариев</td>
    </tr>
    <tr>
        <td>Добавление видео в «Сохраненные»</td>
        <td>В среднем 5% пользователей добавляют видео в сохранённые, всего: 76 * 0,05 = <b>3,8 млн</b></td>
    </tr>
    <tr>
        <td>Поиск видео</td>
        <td>В среднем пользователь делает 2 поиска в день, всего: 76 * 2 = <b>152 млн</b></td>
    </tr>
    <tr>
        <td>Просмотр видео из рекомендаций</td>
        <td>В среднем 10 видео в день на пользователя, всего: 76 * 10 = <b>760 млн</b></td>
    </tr>
    <tr>
        <td>Просмотр видео из подписок</td>
        <td>В среднем 3 видео в день на пользователя, всего: 76 * 3 = <b>228 млн</b></td>
    </tr>
    <tr>
        <td>Просмотр трансляций</td>
        <td>4% пользователей смотрят трансляции, всего: 76 * 0,04 = <b>3,04 млн</b></td>
    </tr>
</table>


### Технические метрики
1 трек хранится в трек режимах качества: превосходное(lossless), оптимальное и экономичное, в первом режиме трек занимает около 40 МБ, в оптимальном режиме 7 МБ, в Экономичном около 3 МБ, итого на 1 трек приходится 50 МБ данных для хранения.

В среднем подкасты длятся около 30 мин и занимают около 70 МБ памяти.
Таблица 4 - Размер хранения в разбивке по типам данных
<table>
    <tr>
        <th>Тип хранения</th>
        <th>Размер</th>
    </tr>
    <tr>
        <td>Пользователи</td>
        <td>из таблицы 2, на одного пользователя необходимо (25,8 + 32) = 57,8 МБ, тогда на 24 млн пользователей, 1322ТБ</td>
    </tr>
    <tr>
        <td>Треки</td>
        <td>на 1 трек 50 МБ, всего 76 млнов треков, тогда для хранения всех понадобится 3624ТБ</td>
    </tr>
    <tr>
        <td>Подкасты</td>
        <td>В Яндекс музыке около 165тыс подкастов, тогда все подкасты будут занимать около 11ТБ</td>
    </tr>
</table>

Битрейт песен лежит в диапазоне от 24 до 320 Кбит/c. Для вычислений возьмем средний - 128 Кбит/c.
Таблица 5 - Сетевые метрики
<table>
    <tr>
        <th>Тип действия</th>
        <th>Пиковое потребление в течение суток, Гбит/с</th>
        <th>Суммарный суточный, Гбайт/сутки</th>
        <th>RPS (средний)</th>
        <th>RPS (пиковый)</th>
    </tr>
    <tr>
        <td>Воспроизведение музыки</td>
        <td>10 000 000 * 128Кбит/с = 1 280 000 000Кбит/c = 1220</td>
        <td>14,4млн * 148мин * 60с * 128 Кбит/c = 15 609 375</td>
        <td>Всего 14,4 млн юзеров, тк в сутки примерно 148 минут средний пользователь слушает музыку, и запрос на новый чанк случается раз в ~ 10 секунд, те ~ 6 раз в минуту, то средний рпс будет, rps = 14,4млн * 148мин * 6 / 86400с = 148 000</td>
        <td>В пик около 10 млн пользователей слушает музыку одновременно, rps = 10 000 000 </td>
    </tr>
    <tr>
        <td>Авторизация/регистрация</td>
        <td>Авторизация/регистрация</td>
        <td>14,4 миллиона</td>
        <td>14,4 миллиона</td>
        <td>14,4 миллиона</td>
    </tr>
    <tr>
        <td>Добавление/удаление треков в/из плейлист</td>
        <td>Авторизация/регистрация</td>
        <td>14,4 миллиона</td>
        <td>14,4 миллиона</td>
        <td>14,4 миллиона</td>
    </tr>
    <tr>
        <td>Прослушивание треков из истории</td>
        <td>Авторизация/регистрация</td>
        <td>14,4 миллиона</td>
        <td>14,4 миллиона</td>
        <td>14,4 миллиона</td>
    </tr>
    <tr>
        <td>Поиск исполнителя, трека, альбома</td>
        <td>Авторизация/регистрация</td>
        <td>14,4 миллиона</td>
        <td>14,4 миллиона</td>
        <td>14,4 миллиона</td>
    </tr>
    <tr>
        <td>Поиск треков по жанру</td>
        <td>Авторизация/регистрация</td>
        <td>14,4 миллиона</td>
        <td>14,4 миллиона</td>
        <td>14,4 миллиона</td>
    </tr>
    <tr>
        <td>Прослушивание подкастов</td>
        <td>Авторизация/регистрация</td>
        <td>14,4 миллиона</td>
        <td>14,4 миллиона</td>
        <td>14,4 миллиона</td>
    </tr>
    <tr>
        <td>Прослушивание чартов</td>
        <td>Авторизация/регистрация</td>
        <td>14,4 миллиона</td>
        <td>14,4 миллиона</td>
        <td>14,4 миллиона</td>
    </tr>
</table>

